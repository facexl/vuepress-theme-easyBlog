---
title: 2020回顾    
category: chat
---

##  2020回顾    

### 1.打造了适合电商业务的 low-code 平台  

运营拖拽组件实现活动页面的创建，现在来看(截止20210219)，线上活动页面列表已经躺了80个页面，自己做的东西加快了运营工作效率还是倍感欣喜。  

### 2.错误上报系统  

闲暇之余学习 koa mysql 搭建后端系统，并实现了 C 端错误收集接口，和管理端的错误查询，虽说错误收集还比较粗糙，只上报了用户id、系统信息、错误信息，没有收集到用户什么行为导致报错，但也足够方便排查大部分异常情况了。最重要的是，一脚踹开了后端的大门。  

### 3.解决了公司项目的几个痛点  

- 商品设置 sku 由于是排列组合的形式，很容易几个规格就组合出一大堆的 sku ，最后导致 sku 列表超长产生滚动卡顿。  特别是数据回填，老代码甚至采用了双重循环比对、回填数据，1000 长度的列表会循环 1000^2 次！浏览器直接卡死，有运营反应有时候他添加一个多规格商品要花一个多小时在屏幕前等待浏览器反应，感叹运营同事敬业之余，我接手了项目优化。首先采用 hash 大法，把服务端返回的数组改造成唯一标识键值对对象，然后单次循环数组比对数据，其实也就是空间换了时间，原理是这样，实际情况比我描述的复杂多了，光是唯一标识，都让人掉了不少头发，最后利用规格值 id 从小到大排列解决了痛点。这样优化掉了 `js 执行时间` 导致的卡顿，进入到超长列表渲染的问题上，原理自然是`只渲染用户看得到的部分`，具体实现就仁者见仁智者见智了。我是用的滚动计算一对儿数组角标，全量渲染角标内的数据，角标范围之外渲染一个空的有高度的`div`，这里，有高度很重要，因为实际滚动条必须撑满，虽然已经满足了实际应用，但仍有不足之处，这样并不能实现列表无限长度，因为始终每个空的`div`也算一个`dom`，不可能无限累计，于是有了优化版本的方案，具体[demo](https://github.com/facexl/infinityList)我上传到了`github`上  

- 同事负责的一个管理系统，打包越来越慢，甚至到了需要500多秒的地步，我用`webpack-bundle-analyzer`分析了`build`后的依赖图，有几个比较大`js`改为了`cdn`引入，但意义不大，打包还是巨慢，因为实际超级大的是 `css`，达到了`3mb`!实在不知道哪些地方出了错，只能用路由注释，慢慢缩小排查范围的土方法，最后锁定了几个文件，这几个文件夹统统`scope`单独引用了全量的 `element-ui` 样式文件(ಥ_ಥ),删了打包时间缩短到 `70秒`，笔者很笨，实在不知道这种情况我能怎么聪明应对,下面是写满心酸的笔记(ಥ_ಥ)，:  
```javascript

product.js css 609kb js 1.22m 55s
  finance.js css 616kb js 1.22m 55s
  statistics css 634kb js 1.22 55s
  weiwei 642 1.22 55s
  user 938 1.22  63s 
  service 3.61mb 1.22 189s 

  移除  service 后  980kb 80s
  only service 2.99m 154s 
  移除 会话管理 837kb 40s  

  移除会话管理 chat 组件   2.72mb 109s
  移除会话管理 user 组件 2.98mb 136s 
  移除 Speech Order 组件 1.11mb 58s
  移除 Speech 2.72mb 122s
  移除 order 1.37mb 69s 

  锁定 客服 聊天界面的 order 组件  

  移除 order 下的 Goods、Sales 2.45mb 118s 
  移除 order 下的 Customer 2.72mb 132s 
  移除 order 下的 more-order 2.72mb 120s
  移除 order 下的 createWorkOrder 2.98mb 138s  
  移除
    createWorkOrder,
    Customer,
    MoreOrder,
    Goods,
    Sales, 83s 1.64mb ?????

  移除 order 下的 Sales Customer 2.45mb 113s  

  ```  

  - 第一次参与了游戏的开发，其实不难，就是比较有新鲜感，全程用 websocket 和服务器交流的种树游戏。  
  - 同事硬着头皮把小程序组件代码上传到了小程序插件，然后用插件的形式把组件引入项目，好像很合理，却造成了一堆的问题，包括但不限于：  
  1.没法调试，组件代码都在另一个项目当然没法调试  
  2.不方便测试，因为改了插件代码又要等插件审核，没法及时提测  
  其实但就不好调试来说，就已经无法忍受了，`node_modules`再辣鸡，我们总可以进入调试，康康数据进来没有什么的，你，腾讯的小程序，你们的插件是`kpi`项目吗(当然更可能我们的使用场景水土不服)  
  为解决这些问题我把插件项目作为主项目的`git submodule`引入，
  然后开发了`node`脚本，开发时运行脚本实现`本地引入`和`插件引入`的无缝切换，解决了调试和提测问题  

  - 开发客服系统(由于和寻常业务有所区别，还是提一嘴)  

  ## 2020遗憾  

  - 没有大量使用 `TypeScript`  
  - 没有写单元测试  
   
  ## 2021展望  

  不忘初心、持续精进  
