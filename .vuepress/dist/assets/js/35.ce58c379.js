(window.webpackJsonp=window.webpackJsonp||[]).push([[35],{344:function(v,_,e){"use strict";e.r(_);var a=e(5),t=Object(a.a)({},function(){var v=this,_=v.$createElement,e=v._self._c||_;return e("ContentSlotsDistributor",{attrs:{"slot-key":v.$parent.slotKey}},[e("h2",{attrs:{id:"spa应用自动化部署-架构"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#spa应用自动化部署-架构","aria-hidden":"true"}},[v._v("#")]),v._v(" SPA应用自动化部署_架构")]),v._v(" "),e("p",[v._v("昨天提了离职，今天本来是要开始交接工作的，但是跟我对接的人请假了。趁着这个空档，我捋了下我们的前端SPA应用的部署和管理方式。在此之前谈谈我认为的，理想的前端工程化的基础服务应该包含哪些东西：")]),v._v(" "),e("ul",[e("li",[v._v("脚手架创建项目")]),v._v(" "),e("li",[v._v("自动配置好开发 构建 上报 部署脚本 一系列东西")]),v._v(" "),e("li",[v._v("然后上报内容会加上 依赖库、构建的一些情况")]),v._v(" "),e("li",[v._v("平台按项目划分 每个项目分为项目基础、构建报告、单测报告、页面测试以及性能数据（白屏时间 网络加载情况）")]),v._v(" "),e("li",[v._v("还有预警  比如构建体积过大、构建时间突增、用了过期的库等等")])]),v._v(" "),e("h3",{attrs:{id:"version-ⅰ"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#version-ⅰ","aria-hidden":"true"}},[v._v("#")]),v._v(" Version Ⅰ")]),v._v(" "),e("p",[v._v("为了表达得清楚，我画了思维导图：\n"),e("img",{attrs:{src:"http://img.xlcool.cn/blog/WX20190301-160421@2x.png?imageView2/0/h/580",alt:""}})]),v._v(" "),e("h4",{attrs:{id:"说明"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#说明","aria-hidden":"true"}},[v._v("#")]),v._v(" 说明")]),v._v(" "),e("p",[e("strong",[v._v("访问过程")]),v._v("：浏览器请求"),e("code",[v._v("Nginx")]),v._v("web服务器，"),e("code",[v._v("Nginx")]),v._v("经过负载权衡，转发请求至某一台"),e("code",[v._v("java")]),v._v("服务器，"),e("code",[v._v("java")]),v._v("请求我们的"),e("code",[v._v("文件服务器")]),v._v("即"),e("code",[v._v("Projects Manager")]),v._v("得到文件服务器指定的资源"),e("code",[v._v("CDN地址")]),v._v("，然后用"),e("code",[v._v("Thymeleaf")]),v._v("渲染最新的资源链接到模板"),e("code",[v._v("html")]),v._v("上。然后把完整的"),e("code",[v._v("html")]),v._v("交给"),e("code",[v._v("浏览器")]),v._v("。浏览器开始"),e("code",[v._v("dom")]),v._v("解析，遇到"),e("code",[v._v("script")]),v._v("标签包裹的"),e("code",[v._v("资源链接")]),v._v("请求"),e("code",[v._v("CDN服务器")]),v._v("得到前端"),e("code",[v._v("js/css")]),v._v("资源。")]),v._v(" "),e("p",[e("strong",[v._v("优势")]),v._v("：")]),v._v(" "),e("ul",[e("li",[v._v("由于用户访问时，"),e("code",[v._v("java")]),v._v("服务是实时获取的"),e("code",[v._v("Projects Manager")]),v._v("指定的前端资源，如果出现线上前端"),e("code",[v._v("bug")]),v._v("，前端开发在修复好后，可以直接打包上传到cdn，然后去"),e("code",[v._v("Projects Manager")]),v._v("的后台管理系统上，设置刚刚修复bug打包的资源为线上资源，线上bug就修复掉了。比起曾经需要长时间发布庞大的java项目，明显提高了修复效率以及减少了宕机风险。")]),v._v(" "),e("li",[v._v("每个前端项目都分配有一个id,"),e("code",[v._v("Projects Manager")]),v._v("可以统一管理大量前端项目静态资源。")])]),v._v(" "),e("p",[e("strong",[v._v("劣势")])]),v._v(" "),e("ul",[e("li",[v._v("前端项目固定在了指定"),e("code",[v._v("java")]),v._v("项目中，造成请求其他"),e("code",[v._v("java")]),v._v("服务有跨域问题。解决方式经常是请求自己所在的"),e("code",[v._v("java")]),v._v("项目，然后后端人员再去请求其他"),e("code",[v._v("java")]),v._v("服务。")]),v._v(" "),e("li",[e("code",[v._v("java")]),v._v("项目需要在"),e("code",[v._v("yml")]),v._v("配置中添加前端的"),e("code",[v._v("Projects Manager")]),v._v("访问地址和具体的前端项目"),e("code",[v._v("id")]),v._v("。经常有后端人员不知道这是什么，然后在新建测试环境的时候忽略他们。最后造成无法访问。")])]),v._v(" "),e("h3",{attrs:{id:"version-ⅱ"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#version-ⅱ","aria-hidden":"true"}},[v._v("#")]),v._v(" Version Ⅱ")]),v._v(" "),e("p",[v._v("这个版本当然是为了解决上个版本的问题而诞生。如果说上个版本和后端项目还有一丝的联系，这个版本前后端就彻底分离了。\n"),e("img",{attrs:{src:"http://img.xlcool.cn/blog/WX20190301-170943@2x.png",alt:""}})]),v._v(" "),e("h4",{attrs:{id:"说明-2"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#说明-2","aria-hidden":"true"}},[v._v("#")]),v._v(" 说明")]),v._v(" "),e("p",[e("code",[v._v("Projects Manager")]),v._v("除了管理项目资源，还承载了模板的渲染。虽然这个"),e("code",[v._v("Node")]),v._v("服务只用来渲染模板和转发请求有点浪费，但如果它管理了大量的单页应用，又似乎还说得过去。在正常的请求前添加标识符，然后在"),e("code",[v._v("Projects Manager")]),v._v("中配置标志符和java服务的映射，实现代理到不同的java服务。")]),v._v(" "),e("h3",{attrs:{id:"需要做的事情"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#需要做的事情","aria-hidden":"true"}},[v._v("#")]),v._v(" 需要做的事情")]),v._v(" "),e("p",[v._v("以 Version Ⅱ 为例，需提供：")]),v._v(" "),e("ul",[e("li",[v._v("实现提供上传文件到CDN的webpack插件 需要控制权限 需要强制备注上传原因")]),v._v(" "),e("li",[v._v("提供管理项目静态资源的管理后台，包括新增项目、新增用户权限、修改指定环境静态资源、域名管理、代理目标管理等功能")]),v._v(" "),e("li",[v._v("提供Node Server，用以渲染SPA应用的模板文件以及代理请求到其他服务器")]),v._v(" "),e("li",[v._v("提供对项目模板的个性化定制")])])])},[],!1,null,null,null);t.options.__file="20190301_autoPublish.md";_.default=t.exports}}]);