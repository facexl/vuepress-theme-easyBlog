<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>网页访问全过程概述 | 小浪博客</title>
    <meta name="description" content="肖浪的博客网站,由vuepress驱动,主要记录前端技术">
    <link rel="icon" href="https://avatars3.githubusercontent.com/u/25611177?s=460&amp;v=4">
  <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
  <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
    
    <link rel="preload" href="/assets/css/0.styles.9fe99f9b.css" as="style"><link rel="preload" href="/assets/js/app.38da5540.js" as="script"><link rel="preload" href="/assets/js/3.fd8076e4.js" as="script"><link rel="preload" href="/assets/js/32.f20d3c1b.js" as="script"><link rel="prefetch" href="/assets/js/1.e0d907ed.js"><link rel="prefetch" href="/assets/js/10.4dc66f6f.js"><link rel="prefetch" href="/assets/js/11.be60eeef.js"><link rel="prefetch" href="/assets/js/12.679614a9.js"><link rel="prefetch" href="/assets/js/13.6e24d490.js"><link rel="prefetch" href="/assets/js/14.733a884f.js"><link rel="prefetch" href="/assets/js/15.22ef630a.js"><link rel="prefetch" href="/assets/js/16.a1a4e424.js"><link rel="prefetch" href="/assets/js/17.3111b5f6.js"><link rel="prefetch" href="/assets/js/18.dc7e36b6.js"><link rel="prefetch" href="/assets/js/19.26d6ddb6.js"><link rel="prefetch" href="/assets/js/20.d8f763ff.js"><link rel="prefetch" href="/assets/js/21.1bbf465b.js"><link rel="prefetch" href="/assets/js/22.cedf8f01.js"><link rel="prefetch" href="/assets/js/23.88485d58.js"><link rel="prefetch" href="/assets/js/24.234e7abc.js"><link rel="prefetch" href="/assets/js/25.802e933b.js"><link rel="prefetch" href="/assets/js/26.e3cdab24.js"><link rel="prefetch" href="/assets/js/27.54a42cce.js"><link rel="prefetch" href="/assets/js/28.9b3b11aa.js"><link rel="prefetch" href="/assets/js/29.1fc27cea.js"><link rel="prefetch" href="/assets/js/30.95607216.js"><link rel="prefetch" href="/assets/js/31.6eafed19.js"><link rel="prefetch" href="/assets/js/33.904da5b7.js"><link rel="prefetch" href="/assets/js/34.ce0b85ee.js"><link rel="prefetch" href="/assets/js/35.ad45108e.js"><link rel="prefetch" href="/assets/js/36.9f69d3cb.js"><link rel="prefetch" href="/assets/js/37.ae5fc6d6.js"><link rel="prefetch" href="/assets/js/38.262255a9.js"><link rel="prefetch" href="/assets/js/39.016ec0cb.js"><link rel="prefetch" href="/assets/js/4.e65d1450.js"><link rel="prefetch" href="/assets/js/40.5c95c74e.js"><link rel="prefetch" href="/assets/js/41.a75760fc.js"><link rel="prefetch" href="/assets/js/42.72b6c78c.js"><link rel="prefetch" href="/assets/js/43.5e5b00e1.js"><link rel="prefetch" href="/assets/js/44.eb3d187a.js"><link rel="prefetch" href="/assets/js/5.1297a032.js"><link rel="prefetch" href="/assets/js/6.4b7b8981.js"><link rel="prefetch" href="/assets/js/7.fa696063.js"><link rel="prefetch" href="/assets/js/8.8f9fe41a.js"><link rel="prefetch" href="/assets/js/9.754d4186.js">
    <link rel="stylesheet" href="/assets/css/0.styles.9fe99f9b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><a href="https://github.com/facexl/facexl.github.io" aria-label="View source on Github" class="github-corner"><svg viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" class="octo-arm" style="transform-origin: 130px 106px"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a> <div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <div class="links"><nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="/category/all/1.html" class="nav-link">All</a></div><div class="nav-item"><a href="/category/study/1.html" class="nav-link">Study</a></div><div class="nav-item"><a href="/category/practice/1.html" class="nav-link">Practice</a></div><div class="nav-item"><a href="/category/chat/1.html" class="nav-link">Chat</a></div> <div class="avatar-container" data-v-b9c546a0><div class="box" data-v-b9c546a0><div class="bg" data-v-b9c546a0><div class="bg-img" style="background-image:;opacity:0;" data-v-b9c546a0></div> <div id="spinner-detail" data-v-e5a4d2a0 data-v-b9c546a0><div class="xdot1" data-v-e5a4d2a0></div> <div class="xdot2" data-v-e5a4d2a0></div></div></div> <div class="author" data-v-b9c546a0>小浪</div> <div class="desc" data-v-b9c546a0>一个前端</div> <nav class="site-state motion-element" data-v-b9c546a0><div class="site-state-item site-state-posts" data-v-b9c546a0><a href="javascript:;" data-v-b9c546a0><span class="site-state-item-count" data-v-b9c546a0>27</span> <span class="site-state-item-name" data-v-b9c546a0>日志</span></a></div> <div class="site-state-item site-state-categories" data-v-b9c546a0><a href="javascript:;" data-v-b9c546a0><span class="site-state-item-count" data-v-b9c546a0>4</span> <span class="site-state-item-name" data-v-b9c546a0>分类</span></a></div></nav></div></div> <!----></nav> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="/category/all/1.html" class="nav-link">All</a></div><div class="nav-item"><a href="/category/study/1.html" class="nav-link">Study</a></div><div class="nav-item"><a href="/category/practice/1.html" class="nav-link">Practice</a></div><div class="nav-item"><a href="/category/chat/1.html" class="nav-link">Chat</a></div> <div class="avatar-container" data-v-b9c546a0><div class="box" data-v-b9c546a0><div class="bg" data-v-b9c546a0><div class="bg-img" style="background-image:;opacity:0;" data-v-b9c546a0></div> <div id="spinner-detail" data-v-e5a4d2a0 data-v-b9c546a0><div class="xdot1" data-v-e5a4d2a0></div> <div class="xdot2" data-v-e5a4d2a0></div></div></div> <div class="author" data-v-b9c546a0>小浪</div> <div class="desc" data-v-b9c546a0>一个前端</div> <nav class="site-state motion-element" data-v-b9c546a0><div class="site-state-item site-state-posts" data-v-b9c546a0><a href="javascript:;" data-v-b9c546a0><span class="site-state-item-count" data-v-b9c546a0>27</span> <span class="site-state-item-name" data-v-b9c546a0>日志</span></a></div> <div class="site-state-item site-state-categories" data-v-b9c546a0><a href="javascript:;" data-v-b9c546a0><span class="site-state-item-count" data-v-b9c546a0>4</span> <span class="site-state-item-name" data-v-b9c546a0>分类</span></a></div></nav></div></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>网页访问全过程概述</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/blog/20190219_happenInBrowser.html#网页访问全过程概述" class="sidebar-link">网页访问全过程概述</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/20190219_happenInBrowser.html#基本过程" class="sidebar-link">基本过程</a></li><li class="sidebar-sub-header"><a href="/blog/20190219_happenInBrowser.html#浏览器渲染过程-敲黑板" class="sidebar-link">浏览器渲染过程(敲黑板)</a></li><li class="sidebar-sub-header"><a href="/blog/20190219_happenInBrowser.html#css阻塞" class="sidebar-link">css阻塞</a></li><li class="sidebar-sub-header"><a href="/blog/20190219_happenInBrowser.html#js阻塞" class="sidebar-link">js阻塞</a></li><li class="sidebar-sub-header"><a href="/blog/20190219_happenInBrowser.html#reference" class="sidebar-link">reference</a></li></ul></li></ul></div></li></ul> </div> <div class="page"> <div class="content default"><h2 id="网页访问全过程概述"><a href="#网页访问全过程概述" aria-hidden="true" class="header-anchor">#</a> 网页访问全过程概述</h2> <h3 id="基本过程"><a href="#基本过程" aria-hidden="true" class="header-anchor">#</a> 基本过程</h3> <ul><li>1.在用户输入url后，客户端会先把域名发送至DNS服务器，服务器会返回此域名对应的IP地址,<code>当然也可能直接命中浏览器DNS缓存</code>。DNS(Domain Name System),即<a href="https://zh.wikipedia.org/wiki/%E5%9F%9F%E5%90%8D%E7%B3%BB%E7%BB%9F" target="_blank" rel="noopener noreferrer">域名解析系统<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li>2.客户端通过IP地址锁定目标服务器，然后与服务器建立TCP网络连接。<a href="https://zh.wikipedia.org/wiki/%E4%BC%A0%E8%BE%93%E6%8E%A7%E5%88%B6%E5%8D%8F%E8%AE%AE" target="_blank" rel="noopener noreferrer">传输控制协议（Transmission Control Protocol，缩写：TCP）<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li>3.随后客户端向服务端抛出客户端的HTTP请求</li> <li>4.服务端处理完客户端的请求之后，把目标数据放在 HTTP 响应里返回给客户端，拿到响应数据的浏览器就可以开始走一个渲染的流程。</li> <li>5.渲染完毕，页面便呈现给了用户，并时刻等待响应用户的操作</li></ul> <h3 id="浏览器渲染过程-敲黑板"><a href="#浏览器渲染过程-敲黑板" aria-hidden="true" class="header-anchor">#</a> 浏览器渲染过程(敲黑板)</h3> <h4 id="浏览器内核"><a href="#浏览器内核" aria-hidden="true" class="header-anchor">#</a> 浏览器内核</h4> <p>浏览器内核可以分成两部分：渲染引擎（Layout Engine 或者 Rendering Engine）和 JS 引擎。渲染引擎又包括了 <code>HTML 解释器、CSS 解释器、布局、网络、存储、图形、音视频、图片解码器等等零部件</code>。浏览器内核决定了浏览器解释网页语法的方式。常见的浏览器内核可以分为四种：<code>Trident（IE）、Gecko（火狐）、Blink（Chrome、Opera）、Webkit（Safari）</code>。其中Blink 其实也是基于 Webkit 衍生而来的一个分支。所以以 Webkit 为例，对现代浏览器的渲染过程进行剖析。</p> <h4 id="渲染过程概念"><a href="#渲染过程概念" aria-hidden="true" class="header-anchor">#</a> 渲染过程概念</h4> <p>简单来说，渲染引擎根据 HTML 文件描述构建相应的数学模型，调用浏览器各个零部件，从而将网页资源代码转换为图像结果，这个过程就是渲染过程，具体如下(<code>有一些操作是并行进行</code>)：</p> <ul><li><code>解析 HTML</code><br>
在这一步浏览器执行了所有的加载解析逻辑，在解析 HTML 的过程中发出了页面渲染所需的各种外部资源请求。</li> <li><code>计算样式</code><br>
浏览器将识别并加载所有的 CSS 样式信息与 DOM 树合并，最终生成页面 render 树（:after :before 这样的伪元素会在这个环节被构建到 DOM 树中）。</li> <li><code>计算图层布局</code><br>
页面中所有元素的相对位置信息，大小等信息均在这一步得到计算。</li> <li><code>绘制图层</code><br>
在这一步中浏览器会根据我们的 DOM 代码结果，把每一个页面图层转换为像素，并对所有的媒体文件进行解码。</li> <li><code>整合图层，得到页面</code><br>
最后一步浏览器会合并合各个图层，将数据由 CPU 输出给 GPU 最终绘制在屏幕上。（复杂的视图层会给这个阶段的 GPU 计算带来一些压力，在实际应用中为了优化动画性能，我们有时会手动区分不同的图层）。</li></ul> <div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>🌲解析Html会得到DOM树（DOM tree）。<br>
🌲解析 CSS（包括外部 CSS 文件和样式元素）创建的是 CSSOM 树.<code>CSSOM 的解析过程与 DOM 的解析过程是并行的。</code><br>
🌲CSSOM 与 DOM 结合，之后我们得到的就是渲染树（Render tree ）。<br>
🌲从根节点递归调用，计算每一个元素的大小、位置等，给每个节点所应该出现在屏幕上的精确坐标，我们便得到了基于渲染树的布局渲染树（Layout of the render tree）。<br>
🌲绘制渲染树: 遍历渲染树，每个节点将使用 UI 后端层来绘制。整个过程叫做绘制渲染树（Painting the render tree）。</p></div> <p>简单总结:首先是基于 HTML 构建一个 DOM 树，这棵 DOM 树与 CSS 解释器解析出的 CSSOM 相结合，就有了布局渲染树。最后浏览器以布局渲染树为蓝本，去计算布局并绘制图像，我们页面的初次渲染就大功告成了。</p> <p>之后每当一个新元素加入到这个 DOM 树当中，浏览器便会通过 CSS 引擎查遍 CSS 样式表，找到符合该元素的样式规则应用到这个元素上，然后再重新去绘制它。</p> <h3 id="css阻塞"><a href="#css阻塞" aria-hidden="true" class="header-anchor">#</a> css阻塞</h3> <p>DOM 和 CSSOM 合力才能构建渲染树。这一点会给性能造成严重影响：默认情况下，CSS 是阻塞的资源。浏览器在构建 CSSOM 的过程中，不会渲染任何已处理的内容。即便 DOM 已经解析完毕了，只要 CSSOM 不 OK，那么渲染这个事情就不 OK（这主要是为了避免没有 CSS 的 HTML 页面丑陋地“裸奔”在用户眼前）。
即:<code>CSS 是阻塞渲染的资源。需要将它尽快地下载到客户端，以便缩短首次渲染的时间。</code></p> <p>关于这点我做了测试,
准备好简单的代码。</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token doctype">&lt;!DOCTYPE html&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>viewport<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>width=device-width, initial-scale=1.0<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>X-UA-Compatible<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>ie=edge<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>stylesheet<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>https:xxxx/css/app.8c13afb71dd90515886feb84f270afd4.css<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    123
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>然后打开chrome无痕模式，打开控制台，右上角三个点-&gt;more tools-&gt;network conditions-&gt;设置network throttling为slow 3g，然后打开这个html文件就会看到加载了好一会儿才会渲染出来。说明浏览器在遇到link就开始构建CSSOM树，在构建过程中，阻塞了页面的渲染。</p> <h3 id="js阻塞"><a href="#js阻塞" aria-hidden="true" class="header-anchor">#</a> js阻塞</h3> <p><code>JS 引擎是独立于渲染引擎存在的。</code>我们的 JS 代码在文档的何处插入，就在何处执行。当 HTML 解析器遇到一个 script 标签时，它会暂停渲染过程，将控制权交给 JS 引擎。除了把script标签写在末尾，也可以使用<code>defer 和 async</code>合理规避</p> <ul><li>async 模式下，JS 不会阻塞浏览器做任何其它的事情。它的加载是异步的，当它加载结束，JS 脚本会立即执行。</li> <li>defer 模式下，JS 的加载是异步的，执行是被推迟的。等整个文档解析完成、DOMContentLoaded 事件即将被触发时，被标记了 defer 的 JS 文件才会开始依次执行。</li></ul> <div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>从应用的角度来说，一般脚本与 DOM 元素和其它脚本之间的依赖关系不强时，会选用 async；当脚本依赖于 DOM 元素和其它脚本的执行结果时，会选用 defer。</p></div> <h3 id="reference"><a href="#reference" aria-hidden="true" class="header-anchor">#</a> reference</h3> <p>https://juejin.im/book/5b936540f265da0a9624b04b</p></div> <!---->  <!----> <div id="gitalk-container"></div></div></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.38da5540.js" defer></script><script src="/assets/js/3.fd8076e4.js" defer></script><script src="/assets/js/32.f20d3c1b.js" defer></script>
  </body>
</html>
